<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rally Typer - Game</title>
    <link
      rel="stylesheet"
      href="/game/assets/css/styles.css?v=1.8"
      type="text/css"
    />
    <script
      type="module"
      crossorigin
      src="/assets/modulepreload-polyfill-B5Qt9EMX.js"
    ></script>
  </head>

  <body>
    <!-- Loading Screen -->
    <div class="loading">
      <h3>Loading...</h3>
      <div class="loading-bar-container">
        <div class="loading-bar"></div>
      </div>
    </div>

    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- Typing Text Display -->
    <div class="text-div">
      <div class="text-content">-Press any key to start-</div>
      <div class="text-cover"></div>
    </div>

    <!-- Game Results Screen -->
    <div class="ending-screen">
      <h2>1st Place!</h2>
      <p class="stats">Time:</p>
      <p class="stats">Accuracy:</p>
      <p class="stats">GWAM:</p>
      <p class="stats">Personal Best GWAM:</p>
      <button onclick="resetGame()">Play Again</button>
      <div class="clear"></div>
    </div>

    <!-- Countdown Timer -->
    <div class="countdown">3</div>

    <!-- Game Scripts -->
    <script src="/game/assets/js/stats.min.js?v=2.0"></script>
    <script src="/game/assets/js/three.min.js?v=2.0"></script>
    <script src="/game/assets/js/GLTFLoader.js?v=2.0"></script>
    <script src="/game/assets/js/Data_Variables.js?v=2.1"></script>
    <script src="/game/assets/js/Game_UI.js?v=2.3"></script>
    <script src="/game/assets/js/Main.js?v=2.1"></script>

    <!-- Game Initialization -->
    <script>
      window.addEventListener("DOMContentLoaded", function () {
        // Get user data from sessionStorage (passed from React app)
        const userDataStr = sessionStorage.getItem("gameUserData");
        const gameDifficulty = sessionStorage.getItem("gameDifficulty");

        if (userDataStr) {
          window.gameUserData = JSON.parse(userDataStr);
        }

        // Get difficulty from URL parameter or sessionStorage
        const urlParams = new URLSearchParams(window.location.search);
        const difficultyParam = urlParams.get("difficulty") || gameDifficulty;

        if (difficultyParam !== null) {
          const difficultyLevel = parseInt(difficultyParam, 10);
          if (
            difficultyLevel >= 0 &&
            difficultyLevel <= 4 &&
            typeof chooseDifficultyLevel !== "undefined"
          ) {
            chooseDifficultyLevel(difficultyLevel);
          }
        }
      });
    </script>
  </body>
</html>
